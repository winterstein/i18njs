function I18N(g,e,c,a){this.version="0.2.3";this.lang=g;this.appTag=c?c:false;this.urlPrefix=a?"":"https://i18n.soda.sh";this.fails={};this.dateFormat=function(h){return h.toLocaleString()};this.numberFormat=function(h){return h.toString()};this.loaded=true;this.en2lang={};this.active(true);if(!e){return}if(!e.match(/^\S+$/)){this._parseFile(e);return}if(e.charAt(0)==="#"){if(!this.appTag){this.appTag=e}if(!this.lang){var d=I18N.getBrowserLanguage();if(d!=="en"){this.lang=d}if(!this.lang){return}}e=this.urlPrefix+"/i18n-trans.csv?tag="+escape(e)+"&lang="+escape(this.lang)}try{this._loadFile(e)}catch(b){console.error(b)}}I18N.prototype.active=function(a){if(a){I18N.active=this}else{if(a!==undefined&&this===I18N.active){I18N.active=null}}return this===I18N.active};I18N.tr=function(a){if(!I18N.active){new I18N()}return I18N.active.tr(a)};I18N._MARKERCHAR="‚êö";I18N.prototype.add=function(e,i,g){var h=[],a=[];var d=this.canon(e,h);var c=this.canon(i,h,true);var b=this.en2lang[d];if(b&&b!==c){if(typeof(b)==="string"){b=[b]}b.push([e,c,g]);this.en2lang[d]=b}else{this.en2lang[d]=c}};I18N.prototype._parseFile=function(d){var b=d.split(/[\r\n]/);for(var c=0;c<b.length;c++){var a=b[c];if(!a||a.charAt(0)=="#"){continue}var e=a.split("\t");if(e.length<2){continue}this.add(e[0],e[1])}console.log("I18N","loaded",this)};I18N.prototype._loadFile=function(d){this.file=d;var c={async:false,cache:true};var b=d.indexOf("//");var a=window.location?window.location:"";var e=d.substring(b+2,b+2+a.length);if(true||b===-1||(a&&e===a)){}else{c.jsonpCallback="_i18nCallback";c.dataType="jsonp";console.log("I18N","Using asynchronous loading: The race is on (this is bad, and may produce unpredictable results). Please add SJTest.js for safer loading.")}this.loaded=false;$.ajax(d,c).done(function(g){this._parseFile(g)}.bind(this)).always(function(){this.loaded=true}.bind(this))};I18N.prototype.tr=function(a){var d=[],c=this.canon(a,d),b=this.en2lang[c];if(b&&typeof(b)!=="string"){b=this._tr2_multi(a,d,b)}if(b){return this.uncanon(b,d)}if(this.loaded&&a){if(this.lang){this.onfail(a,this.lang,c)}}var e=this.uncanon(c,d);return e};I18N.prototype._tr2_multi=function(i,g,k){for(var e=1;e<k.length;e++){if(i===k[e][0]){return k[e][1]}}var a={};for(var d=0;d<g.length;d++){var c=this.categorise(g[d]);if(c){for(p in c){a[p]=c[p]}}}if(a==={}){return k[0]}for(var e=1;e<k.length;e++){var b=k[e][2];if(!b){continue}var h=true;for(p in b){if(a[p]!==b[p]){h=false;break}}if(h){return k[e][1]}}return k[0]};I18N.prototype.categorise=function(a){return false};I18N.prototype.onfail=function(a,g,e){if(this.fails==="!"){return}try{var b=$.parseHTML(a);if(b.length>0&&!b.text()){return}}catch(d){}if(e.length>1000){return}if(this.fails[e]){return}var c=0;for(f in this.fails){c++}if(c>1000){console.warn("I18N","Switching off fail logging ("+g+")");this.fails="!";return}this.fails[e]=true;console.warn("I18N","fail ("+g+"): "+a+"	(internal key: "+e+")");if(!this.appTag){return}a=a.replace(/\s+/g," ");$.ajax({url:this.urlPrefix+"/lg.json",dataType:"jsonp",data:{tag:this.appTag,msg:g+"\t"+a}})};I18N.NUMBER=/[0-9,]+(\.\d+)?/g;I18N.KEEPME=new RegExp(I18N.NUMBER.source+"|{.*?}|\bS+@[a-zA-Z.]+|</?[a-z][a-zA-Z0-9]*[^>]*?>","g");I18N.prototype.canon=function(a,d,c){if(!a){return a}if(d===undefined){d=[]}var b=a.replace(I18N.KEEPME,function(e){if(!c){var g=d.length;d.push(e);return I18N._MARKERCHAR+g}var g=d.indexOf(e);if(g==-1){return e}return I18N._MARKERCHAR+g});b=b.replace(/\s+/g," ");return b};I18N.prototype.uncanon=function(b,c){if(!b){return b}var e=b;if(c.length!=0){e=this._uncanon2_pluralise(b,c)}for(var d=0;d<c.length;d++){var a=c[d];a=this._uncanon2_convert(a);e=e.replace(I18N._MARKERCHAR+d,a)}return e};I18N.prototype._uncanon2_convert=function(a){if(this.numberFormat){var c=Number(a);if(!isNaN(c)){return this.numberFormat(a)}}if(this.dateFormat){var b=Date(a);if(!isNaN(b.valueOf())){return this.dateFormat(b)}}if(a.length>1&&a.charAt(0)=="{"&&a.charAt(a.length-1)=="}"){a=a.substring(1,a.length-1)}return a};I18N.prototype._uncanon2_pluralise=function(d,b){var a=null;for(var c=0;c<b.length;c++){var e=""+b[c];if(e.match(I18N.NUMBER)){if(e==="1"||e==="1.0"){a=false}else{a=true}break}}if(a===true){d=d.replace(/(\w)\((\w{1,3})\)/g,"$1$2")}else{if(a===false){d=d.replace(/(\w)\(\w{1,3}\)/g,"$1")}}return d};I18N.getBrowserLanguage=function(){var a=navigator&&(navigator.language||navigator.userLanguage);if(a){var b=a.substring(0,2);return b}return null};I18N.prototype.canTranslate=function(a){var c=[],b=this.canon(a,c);if(this.en2lang[b]){return true}return false};(function(a){a.fn.tr=function(b){if(!b){b=I18N.active||new I18N()}return this.each(function(){var e=a(this);var c=e.data("i18n-raw");if(!c){c=e.html();e.data("i18n-raw",c)}var d=b.tr(c);e.html(d)})}}(jQuery));